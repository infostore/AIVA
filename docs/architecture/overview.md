# New Data Collector 아키텍처 개요

## 1. 아키텍처 설계 원칙

New Data Collector는 다음과 같은 설계 원칙을 기반으로 구축되었습니다:

- **마이크로서비스 아키텍처**: 각 기능을 독립적인 서비스로 분리하여 확장성과 유지보수성 향상
- **느슨한 결합(Loose Coupling)**: 서비스 간 의존성 최소화
- **높은 응집도(High Cohesion)**: 각 서비스는 명확한 책임과 역할 보유
- **회복성(Resilience)**: 일부 서비스 장애 시에도 전체 시스템 운영 가능
- **확장성(Scalability)**: 개별 서비스 단위로 독립적 확장 가능
- **관찰 가능성(Observability)**: 모니터링, 로깅, 추적을 통한 시스템 상태 가시화

## 2. 시스템 아키텍처

![시스템 아키텍처](../images/system-architecture.png)

### 2.1 마이크로서비스 구성

New Data Collector는 다음과 같은 마이크로서비스로 구성됩니다:

#### API Gateway Service
- 모든 클라이언트 요청의 진입점
- 요청 라우팅, 인증 토큰 검증, 속도 제한 처리
- 서비스 디스커버리 통합
- 기술 스택: FastAPI, Traefik

#### Auth Service
- 사용자 인증 및 권한 관리
- JWT 토큰 발급 및 검증
- OAuth2 인증 지원
- 2단계 인증(2FA) 지원
- 기술 스택: FastAPI, PostgreSQL, Redis

#### Data Collection Service
- 다양한 데이터 소스에서 주식 데이터 수집
- 데이터 소스 추상화 레이어 제공
- 비동기 데이터 수집 작업 처리
- 기술 스택: FastAPI, Celery, RabbitMQ

#### Data Storage Service
- 수집된 데이터의 저장 및 관리
- 데이터 정규화 및 검증
- 데이터 버전 관리
- 기술 스택: FastAPI, PostgreSQL(시계열 파티셔닝), Redis

#### Analysis Service
- 주식 데이터 분석 및 지표 계산
- 기술적 분석 지표 제공
- 데이터 시각화 API 제공
- 기술 스택: FastAPI, NumPy, Pandas, Redis

#### Notification Service
- 사용자 알림 관리
- 이메일, 웹훅, 푸시 알림 지원
- 알림 템플릿 관리
- 기술 스택: FastAPI, RabbitMQ, Redis

### 2.2 공통 컴포넌트

#### 메시지 큐
- 서비스 간 비동기 통신
- 이벤트 기반 아키텍처 지원
- 기술 스택: RabbitMQ

#### 캐싱 시스템
- 자주 요청되는 데이터 캐싱
- 세션 관리
- 기술 스택: Redis

#### 데이터베이스
- 관계형 데이터베이스: PostgreSQL
- 시계열 데이터 파티셔닝 적용

#### 모니터링 및 로깅
- 시스템 메트릭 수집 및 시각화
- 로그 집계 및 분석
- 기술 스택: Prometheus, Grafana, ELK Stack

## 3. 통신 패턴

### 3.1 동기 통신
- REST API: 서비스 간 직접 통신이 필요한 경우
- GraphQL: 복잡한 데이터 쿼리가 필요한 경우

### 3.2 비동기 통신
- 이벤트 기반 통신: 서비스 간 느슨한 결합을 위한 이벤트 발행/구독
- 메시지 큐: 비동기 작업 처리 및 서비스 간 통신

## 4. 배포 아키텍처

![배포 아키텍처](../images/deployment-architecture.png)

### 4.1 컨테이너화
- 모든 서비스는 Docker 컨테이너로 패키징
- Docker Compose를 통한 개발 환경 구성
- Kubernetes를 통한 프로덕션 환경 배포

### 4.2 CI/CD 파이프라인
- GitHub Actions를 통한 자동화된 빌드, 테스트, 배포
- 환경별 배포 전략 (개발, 스테이징, 프로덕션)
- 블루/그린 배포 지원

## 5. 보안 아키텍처

### 5.1 인증 및 권한 부여
- JWT 기반 인증
- OAuth2 지원
- RBAC(Role-Based Access Control) 구현

### 5.2 데이터 보안
- 전송 중 암호화 (TLS/SSL)
- 저장 데이터 암호화
- 민감 정보 관리 (HashiCorp Vault)

### 5.3 네트워크 보안
- 서비스 간 통신 보안
- API 게이트웨이 수준의 보안 정책
- 속도 제한 및 DDoS 방어

## 6. 확장 전략

### 6.1 수평적 확장
- 각 마이크로서비스는 독립적으로 수평 확장 가능
- 부하 분산을 통한 고가용성 확보

### 6.2 데이터베이스 확장
- 읽기/쓰기 분리
- 데이터베이스 샤딩
- 시계열 데이터 파티셔닝

## 7. 장애 대응 전략

### 7.1 회로 차단기 패턴
- 서비스 간 통신 실패 시 장애 격리
- 점진적 복구 메커니즘

### 7.2 재시도 및 백오프 전략
- 일시적 장애에 대한 지능적 재시도
- 지수 백오프 알고리즘 적용

### 7.3 장애 감지 및 복구
- 헬스 체크 및 자가 복구 메커니즘
- 자동화된 알림 및 대응 